# 未布局设备别名与隐藏

1. “未布局设备资源”面板默认展示网关推送的设备（含 MAC）。若需要临时补录交换机，可点击“手动添加交换机”按钮填写名称后直接生成。
2. 用户可通过列表右键菜单对非交换机设备执行两类操作：调整展示别名、暂时隐藏（软删除）；交换机仅支持隐藏操作。
3. 设备拖入画布后，属性面板同步展示类型徽章与当前在线状态；网桥节点额外显示 AP/ST 徽章。
4. 软隐藏后设备仍保留在数据库中，当网关再次推送同一 MAC 时会自动恢复显示。

## 接口说明

- 手动新增已移除；未布局列表依赖 `GET /projects/:projectId/devices` 返回的 `{ id, mac, ... }` 数据。
- 调整名称：`PATCH /projects/:projectId/devices/:deviceId`，请求体 `{ "name": "新名称" }`。
- 隐藏设备：`DELETE /projects/:projectId/devices/:deviceId`，后端仅设置 `hidden_at` 并广播 `device.remove`，后续网关推送会重新显示。

## 删除 / 更新说明

- 编辑和隐藏操作仅适用于当前未布局的设备；执行前若存在未保存的布局修改，系统会提示并先执行一次“保存布局”，保存失败则取消操作。
- 隐藏后设备不会物理删除，后端会在下次网关同步到同一 MAC 时恢复显示。

## 自测

1. `docker compose up -d postgres redis backend frontend` 后打开布局工作台。
2. 点击“手动添加交换机”填写名称，确认新交换机出现在列表中并可拖拽到画布。
3. 通过模拟网关推送（或预置数据）验证其他设备带有 MAC 信息，并显示在未布局列表内；网桥需展示 AP/ST 标记。
4. 对任意非交换机设备执行“编辑名称”，保存后列表立即更新显示，刷新页面仍能看到更新后的别名。
5. 对任意未布局设备执行“隐藏”，确认其从列表消失；再次模拟网关推送同一 MAC 后，设备自动恢复。
6. 布局存在未保存修改时尝试编辑/隐藏，应提示先保存布局；确认后操作完成，保存失败则操作取消。
